
<h2>How to grade</h2>
<% if current_user.experimental_condition == "verify" %>
<p>Evaluation consists of two steps:</p>
<ol>
<li> You'll grade <%= required_identifications %> of your classmates' work (assessment)</li>
<li>You'll be given <%= required_verifications %> assignments, and verify they are correct (verification)</li>
</ol>
<p>Your answers will go through a similar two step evaluation process. When this evaluation completes, and when you complete these two steps, you'll be able to see your grades on this page, and on the Coursera class site</p>
<% elsif current_user.experimental_condition == "identify" %>
<p>You'll grade <%= required_identifications %> of your classmates (per question). For each question, we provide you a set of common correct and wrong answers to help you assess.</p>

<p>Your answers will go through a similar evaluation process. When this evaluation completes, and you complete your own assessments, you'll be able to see your grades on this page, and on the Coursera class site</p>
<% else %>
<p>You'll grade <%= required_baseline %> of your classmates (per question). For each question, we provide you a set of common correct and wrong answers to help you assess.</p>

<p>Your answers will go through a similar evaluation process. When this evaluation completes, you'll be able to see your grades on this page, and on the Coursera class site</p>
<% end -%>
<div class="divider">Your assessments</div>


<table class="table table-hover">
<thead><tr><th>Question</th><th>Status</th><th>Actions</th></tr> </thead>
<tbody>

<% completed_assessment = true %>	
<% @questions.each do |q| %>
<tr>
<td><%= q.title %></td>
<% finished_evaluations = @completed_identifications_by_question[q.id].nil? ? 0 : @completed_identifications_by_question[q.id] 
	finished_verifications = @completed_verifications_by_question[q.id].nil? ? 0: @completed_verifications_by_question[q.id]
%>

<% if q.id < 3 %>
 <td><span class="label label-success">COMPLETE</span> You need to assess 0 classmates. </td>
<% else %>

	<% if current_user.experimental_condition == "verify" %>
	<td>
		<% if finished_evaluations >= required_identifications() && finished_verifications >= required_verifications %>
		<% completed_assessment &&= true %>
		<span class="label label-success">COMPLETE</span>
		<% else %>
		<% completed_assessment = false %>
		<span class="label label-warning">NOT COMPLETE</span>
		<% end %>

	You need to assess <%= [(required_identifications- finished_evaluations),0].max  %> classmates, and verify <%= [(required_verifications- finished_verifications),0].max %>  assessments</td>

	<% elsif current_user.experimental_condition == "identify" %>
	<td>
		<% if finished_evaluations >= required_identifications %>
			<% completed_assessment &&= true %>
			<span class="label label-success">COMPLETE</span>
			<% else %>
			<% completed_assessment = false %>
			<span class="label label-warning">NOT COMPLETE</span>
		<% end %>
		You need to assess <%= [(required_identifications- finished_evaluations),0].max %> classmates.
	</td>

	<% else %>

	<td>
	<% if finished_evaluations >= required_baseline %>
	<% completed_assessment &&= true %>
	<span class="label label-success">COMPLETE</span>
	<% else %>
	<% completed_assessment = false %>
	<span class="label label-warning">NOT COMPLETE</span>
	<% end %>

	You need to assess <%= [(required_baseline- finished_evaluations),0].max %> classmates.</td>
	<% end %>
<% end %>
<td>

<% if current_user.experimental_condition == "verify" %>
	<% if finished_evaluations < required_identifications %>
		<%= link_to "Grade now", grade_identification_path(q.id) %> 
	<% elsif finished_verifications < required_verifications %>
		<%= link_to "Verify assessments", grade_verification_path(q.id) %> 	 
	<% else %>
		<%= link_to "Grade more submissions", grade_identification_path(q.id) %> | <%= link_to "Verify more assessments", grade_verification_path(q.id) %> 	 
 	<% end -%>
<% elsif current_user.experimental_condition == "identify" %>
	<% if finished_evaluations < required_identifications %>
		<%= link_to "Grade now", grade_identification_path(q.id) %> 
	<% else %>
		<%= link_to "Grade more submissions", grade_identification_path(q.id) %>
 	<% end -%>
<% else  %>
<!-- baseline -->
	<% if finished_evaluations < required_baseline %>
		<%= link_to "Grade now", grade_baseline_path(q.id) %> 
	<% else %>
		<%= link_to "Grade more submissions", grade_baseline_path(q.id) %>
 	<% end -%>
<% end -%>
</td>
</tr>
<% end %>
</tbody>

</table>

<% if completed_assessment %>
<p class="lead">
Done grading? Participate in our 1-minute survey, and help make peer grading better! <a href='<%= "https://stanforduniversity.qualtrics.com/SE/?SID=SV_0xmhjCfEGDsnzVz&u=#{current_user.id}&type=#{current_user.experimental_condition}"%>' class="btn btn-primary" target="_blank">Launch survey</a> </p>
<% end %>
<div class="divider">Your grades</div>
<p><%= link_to "See your grades", my_grades_path %></p>